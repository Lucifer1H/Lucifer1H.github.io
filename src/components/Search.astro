{import.meta.env.DEV ? (
  <div class="ml-4 relative">
    <input 
      type="text" 
      placeholder="Search (Preview Only)..." 
      disabled
      class="bg-gray-100 dark:bg-gray-800 border border-gray-200 dark:border-gray-700 text-gray-500 dark:text-gray-400 placeholder-gray-500 rounded-full px-4 py-2 text-sm w-48 cursor-not-allowed"
    />
  </div>
) : (
  <div id="search" class="ml-4"></div>
)}

{ !import.meta.env.DEV && (
  <>
    <link href="/pagefind/pagefind-ui.css" rel="stylesheet">
    <script src="/pagefind/pagefind-ui.js" is:inline></script>
    <script is:inline>
      // Wrap in a function to run when DOM is ready
      function initPagefind() {
        if (typeof PagefindUI !== 'undefined') {
          console.log("Initializing Pagefind UI");
          // Clear any existing instance if re-running
          const searchData = document.querySelector('#search');
          if (searchData) searchData.innerHTML = '';
          
          new PagefindUI({ 
            element: "#search", 
            showSubResults: true,
            showImages: false 
          });
        } else {
          console.error("PagefindUI is undefined");
        }
      }

      if (document.readyState === 'loading') {
        window.addEventListener('DOMContentLoaded', initPagefind);
      } else {
        initPagefind();
      }
    </script>
  </>
)}

<style is:global>
  @reference "../styles/global.css";
  
  /* Customizing Pagefind UI with high specificity to override defaults */
  #search .pagefind-ui__search-input {
    @apply bg-gray-100 dark:bg-gray-800 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-gray-100 placeholder-gray-500 rounded-full px-4 py-2 text-sm focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition-all w-48 focus:w-64;
    border-width: 1px;
  }
  
  #search .pagefind-ui__search-clear {
    @apply text-gray-500 dark:text-gray-400;
  }

  #search .pagefind-ui__drawer {
    @apply bg-white dark:bg-gray-900 border border-gray-100 dark:border-gray-800 shadow-xl rounded-xl mt-2 overflow-hidden;
  }

  #search .pagefind-ui__result {
    @apply border-b border-gray-100 dark:border-gray-800 p-4;
  }

  #search .pagefind-ui__result:hover {
    @apply bg-gray-50 dark:bg-gray-800/50;
  }

  #search .pagefind-ui__result-title {
    @apply font-bold text-gray-900 dark:text-gray-100;
  }

  #search .pagefind-ui__result-excerpt {
    @apply text-sm text-gray-600 dark:text-gray-400;
  }
  
  #search .pagefind-ui__message {
    @apply text-gray-500 dark:text-gray-400 p-4;
  }
</style>
